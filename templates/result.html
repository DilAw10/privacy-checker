<!DOCTYPE html>
<html>
<head>
    <title>Privacy Compliance Checker</title>
    <style>
        .score { font-size: 48px; font-weight: bold; }
        .good { color: #1a7f37; }
        .warn { color: #ff8c00; }
        .bad { color: #c62828; }
        .findings { margin-top: 1rem; }
        .preview { margin-top: 1rem; background:#f6f6f6; padding:1rem; border-radius:6px }
        .code-block { background:#0d0d0d; color:#e6e6e6; padding:12px; border-radius:6px; overflow:auto; max-height:300px; }
        .btn-scan { display:inline-block; padding:8px 12px; margin-right:8px; background:#2b6cb0; color:#fff; border-radius:6px; text-decoration:none; }
    </style>
</head>
<body>
    <h1>Results for {{ url }}</h1>

    {% if error %}
        <p style="color: red;"><strong>Error:</strong> {{ error }}</p>
    {% else %}
        <div>
            <p>Security Score:</p>
            {% set cls = 'good' if security_score >= 80 else ('warn' if security_score >= 50 else 'bad') %}
            <div class="score {{ cls }}">{{ security_score }} / 100</div>

            <div class="findings">
                <h3>Findings</h3>
                {% if findings %}
                    <ul>
                        {% for f in findings %}
                            <li>{{ f }}</li>
                        {% endfor %}
                    </ul>
                {% else %}
                    <p>No issues detected.</p>
                {% endif %}
            </div>

            <div class="preview">
                <h4>Page text preview</h4>
                <pre>{{ preview }}</pre>

                {% if playwright %}
                    <p class="text-muted">Playwright available on server: {{ playwright.available }}{% if playwright.info %} â€” {{ playwright.info }}{% endif %}</p>
                {% endif %}

                {% if screenshot %}
                    <h4>Rendered screenshot</h4>
                    <img src="data:image/png;base64,{{ screenshot }}" alt="Rendered screenshot" style="max-width:100%; border-radius:6px; border:1px solid #ddd;"/>
                {% endif %}

                {% if sanitized_html %}
                    <div style="margin-top:12px;">
                        <button id="toggle-raw" class="btn-scan">Show raw HTML</button>
                        {% if sanitized_html_b64 %}
                            <a class="btn-scan" href="data:text/html;base64,{{ sanitized_html_b64 }}" download="{{ url.replace('://','_') }}.html">Download sanitized HTML</a>
                        {% endif %}

                        <div id="raw-html" style="display:none; margin-top:12px;">
                            <pre class="code-block">{{ sanitized_html | e }}</pre>
                        </div>
                    </div>
                {% endif %}
            </div>
        </div>
    {% endif %}

    <p><a href="/">Check another site</a></p>
<script>
    document.addEventListener('DOMContentLoaded', function(){
        var btn = document.getElementById('toggle-raw');
        if (btn){
            btn.addEventListener('click', function(e){
                e.preventDefault();
                var block = document.getElementById('raw-html');
                if (!block) return;
                if (block.style.display === 'none'){
                    block.style.display = 'block';
                    btn.textContent = 'Hide raw HTML';
                } else {
                    block.style.display = 'none';
                    btn.textContent = 'Show raw HTML';
                }
            });
        }
    });
</script>
</body>
</html>